<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estad√≠sticas y Archivo Cl√≠nico</title>
    <link rel="shortcut icon" href="/estadisticas/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/estadisticas/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/estadisticas/main_css/estilos.css" rel="stylesheet">
</head>
<style>
    .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 16px;
    }

    .card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, .15);
        transition: transform .2s ease;
    }

    .card:hover {
        transform: translateY(-4px);
    }

    .card h4 {
        margin: 0 0 6px;
        font-size: 14px;
        letter-spacing: .5px;
    }

    .card small {
        opacity: .8;
        font-size: 12px;
    }
</style>

<body>
    <div class="glass" id="dashboard">
        <h5>SIMAH</h5>
        <div id="header"></div>
        <div class="grid">
            <div id="cards" class="cards-grid"></div>

            <div class="paginacion">
                <button onclick="cambiarPagina(-1)">‚Üê</button>
                <span id="paginaActual"></span>
                <button onclick="cambiarPagina(1)">‚Üí</button>
            </div>

        </div>
        <div id="footer"></div>
    </div>
    <script>
        fetch('/estadisticas/comun/header.html')
            .then(r => r.text())
            .then(html => {
                document.getElementById('header').innerHTML = html;

                // Cargar sesi√≥n.js despu√©s de insertar el HTML
                const s = document.createElement('script');
                s.src = '/estadisticas/comun/sesion_bk.js';

                s.onload = () => {
                    console.log("üî• sesion_bk.js cargado. Verificando sesi√≥n...");
                    verificarAutenticacion();
                };

                document.body.appendChild(s);
            });

        fetch('/estadisticas/comun/footer.html')
            .then(r => r.text())
            .then(html => {
                document.getElementById('footer').innerHTML = html;

                // Ya existe footerText
                const footer = document.getElementById('footerText');
                if (footer) {
                    footer.innerHTML = `Hecho con ‚ù§Ô∏è por Ricardo ¬∑ ${new Date().getFullYear()}`;
                }
            });
    </script>
    <script>
        let pagina = 1;

        function cargar() {
            google.script.run.withSuccessHandler(render).obtenerRegistros(pagina);
        }

        function render(res) {
            const cont = document.getElementById("cards");
            cont.innerHTML = "";

            res.rows.forEach(r => {
                cont.innerHTML += `
      <div class="card">
        <h4>${r.nombre}</h4>
        <small>Expediente: ${r.expediente}</small><br>
        <small>${r.servicio}</small><br>
        <small>${r.fecha}</small>
      </div>`;
            });

            document.getElementById("paginaActual").innerText =
                `P√°gina ${res.page} de ${Math.ceil(res.total / res.pageSize)}`;
        }

        function cambiarPagina(d) {
            pagina = Math.max(1, pagina + d);
            cargar();
        }

        window.onload = cargar;
        const API_URL = 'https://script.google.com/macros/s/AKfycbzUxd6Yvvb1F2hnJdUHEwm-_og3yTfXnDIuotE_B5VEvS2GnqBIN99lg-_rp6tDjUmg/exec';
        let page = 1;

        async function cargar() {
            const res = await fetch(`${API_URL}?page=${page}`);
            const data = await res.json();
            render(data);
        }

    </script>

    <script src="/estadisticas/comun/estadoSistema.js"></script>
    <script src="/estadisticas/comun/sesion_bk.js"></script>
</body>

</html>