<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro Diario SINBA-SIS-65-P</title>
  <link rel="stylesheet" href="../main_css/estilos.css">
</head>
<body class="fondo-gradiente">

  <div class="contenedor-formulario card sombra">
    <h1 class="titulo-principal">üìã Registro Diario de Movimiento de Pacientes</h1>
    <form id="formCenso" class="formulario">

      <div class="fila">
        <div class="campo">
          <label for="unidad">Unidad</label>
          <input type="text" id="unidad" name="unidad" required>
        </div>
        <div class="campo">
          <label for="fecha">Fecha</label>
          <input type="date" id="fecha" name="fecha" required>
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="servicio">Servicio</label>
          <input type="text" id="servicio" name="servicio">
        </div>
        <div class="campo">
          <label for="sala">Sala</label>
          <input type="text" id="sala" name="sala">
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="numero_cama">N√∫mero de cama</label>
          <input type="text" id="numero_cama" name="numero_cama">
        </div>
        <div class="campo">
          <label for="expediente">No. de expediente</label>
          <input type="text" id="expediente" name="expediente">
        </div>
      </div>

      <div class="campo">
        <label for="nombre">Nombre completo del paciente</label>
        <input type="text" id="nombre" name="nombre" required>
      </div>

      <h2 class="subtitulo">Ingreso</h2>
      <div class="fila">
        <div class="campo">
          <label for="ingreso_tipo">Tipo de ingreso</label>
          <select id="ingreso_tipo" name="ingreso_tipo">
            <option value="">Selecciona</option>
            <option value="Consulta externa">Consulta externa</option>
            <option value="Urgencias">Urgencias</option>
            <option value="Otra unidad">Otra unidad</option>
          </select>
        </div>
        <div class="campo">
          <label for="hora_ingreso">Hora</label>
          <input type="time" id="hora_ingreso" name="hora_ingreso">
        </div>
      </div>

      <h2 class="subtitulo">Egreso</h2>
      <div class="fila">
        <div class="campo">
          <label for="egreso_tipo">Condici√≥n</label>
          <select id="egreso_tipo" name="egreso_tipo">
            <option value="">Selecciona</option>
            <option value="Vivo">Vivo</option>
            <option value="Muerto">Muerto</option>
          </select>
        </div>
        <div class="campo">
          <label for="hora_egreso">Hora</label>
          <input type="time" id="hora_egreso" name="hora_egreso">
        </div>
      </div>

      <div class="campo">
        <label for="observaciones">Observaciones</label>
        <textarea id="observaciones" name="observaciones" rows="3"></textarea>
      </div>

      <button type="submit" class="boton-principal">Guardar registro</button>
    </form>

    <p id="mensaje" class="mensaje-estado"></p>
  </div>

  <script>
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxS6giWNNx--aSaW7OR2EvNOORS9Y8HDCiLZn1u3UjSujCiG6WgUn56pYUD29ESnfYc/exec"; // ‚ö†Ô∏è Reemplaza

    document.getElementById("formCenso").addEventListener("submit", function(e) {
      e.preventDefault();
      const datos = Object.fromEntries(new FormData(this).entries());
      const callbackName = "callback_" + Date.now();

      window[callbackName] = function(respuesta) {
        const mensaje = document.getElementById("mensaje");
        if (respuesta.exito) {
          mensaje.textContent = "‚úÖ " + respuesta.mensaje;
          mensaje.classList.add("exito");
          document.getElementById("formCenso").reset();
        } else {
          mensaje.textContent = "‚ùå " + respuesta.mensaje;
          mensaje.classList.add("error");
        }
        delete window[callbackName];
      };

      const params = new URLSearchParams(datos);
      params.append("callback", callbackName);

      const script = document.createElement("script");
      script.src = `${URL_SCRIPT}?${params.toString()}`;
      document.body.appendChild(script);
    });
  </script>

</body>
</html>
