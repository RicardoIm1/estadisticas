<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SINBA-SIS-65-P | Censo Diario</title>
  <link rel="stylesheet" href="../main_css/estilos.css">
</head>
<body class="fondo-gradiente">

  <!-- === HEADER === -->
  <header class="header glass sombra">
    <h1 class="titulo-app"> SINBA-SIS-65-P</h1>
    <p class="subtitulo-header">Registro diario de movimiento de pacientes</p>
  </header>

  <!-- === CONTENIDO PRINCIPAL === -->
  <main class="glass card sombra contenedor-central">
    <form id="formCenso" class="formulario">
      <h2 class="titulo-seccion">Datos del Paciente</h2>

      <div class="fila">
        <div class="campo">
          <label for="unidad">Unidad</label>
          <input type="text" id="unidad" name="unidad" required>
        </div>
        <div class="campo">
          <label for="fecha">Fecha</label>
          <input type="date" id="fecha" name="fecha" required>
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="servicio">Servicio</label>
          <input type="text" id="servicio" name="servicio">
        </div>
        <div class="campo">
          <label for="sala">Sala</label>
          <input type="text" id="sala" name="sala">
        </div>
      </div>

      <div class="fila">
        <div class="campo">
          <label for="numero_cama">N煤mero de cama</label>
          <input type="text" id="numero_cama" name="numero_cama">
        </div>
        <div class="campo">
          <label for="expediente">No. de expediente</label>
          <input type="text" id="expediente" name="expediente">
        </div>
      </div>

      <div class="campo">
        <label for="nombre">Nombre completo</label>
        <input type="text" id="nombre" name="nombre" required>
      </div>

      <h2 class="titulo-seccion">Ingreso</h2>
      <div class="fila">
        <div class="campo">
          <label for="ingreso_tipo">Origen</label>
          <select id="ingreso_tipo" name="ingreso_tipo">
            <option value="">Selecciona</option>
            <option value="Consulta externa">Consulta externa</option>
            <option value="Urgencias">Urgencias</option>
            <option value="Otra unidad">Otra unidad</option>
          </select>
        </div>
        <div class="campo">
          <label for="hora_ingreso">Hora</label>
          <input type="time" id="hora_ingreso" name="hora_ingreso">
        </div>
      </div>

      <h2 class="titulo-seccion">Egreso</h2>
      <div class="fila">
        <div class="campo">
          <label for="egreso_tipo">Condici贸n</label>
          <select id="egreso_tipo" name="egreso_tipo">
            <option value="">Selecciona</option>
            <option value="Vivo">Vivo</option>
            <option value="Muerto">Muerto</option>
          </select>
        </div>
        <div class="campo">
          <label for="hora_egreso">Hora</label>
          <input type="time" id="hora_egreso" name="hora_egreso">
        </div>
      </div>

      <div class="campo">
        <label for="observaciones">Observaciones</label>
        <textarea id="observaciones" name="observaciones" rows="3"></textarea>
      </div>

      <button type="submit" class="boton-principal"> Guardar registro</button>
      <p id="mensaje" class="mensaje-estado"></p>
    </form>
  </main>

  <!-- === FOOTER === -->
  <footer class="footer glass sombra">
    <p>Hospital Regional de Puerto Vallarta 路 SINBA-SIS-65-P 路 <span id="fechaFooter"></span></p>
  </footer>

  <script>
    // === Script JSONP ===
    const URL_SCRIPT = "https://script.google.com/macros/s/TU_DEPLOY_ID/exec"; // 锔 reemplaza

    document.getElementById("formCenso").addEventListener("submit", function(e) {
      e.preventDefault();
      const datos = Object.fromEntries(new FormData(this).entries());
      const callbackName = "callback_" + Date.now();

      window[callbackName] = function(respuesta) {
        const mensaje = document.getElementById("mensaje");
        mensaje.textContent = respuesta.mensaje;
        mensaje.className = "mensaje-estado " + (respuesta.exito ? "exito" : "error");

        if (respuesta.exito) {
          document.getElementById("formCenso").reset();
          // animaci贸n de confirmaci贸n (si tienes una clase para eso)
          const boton = document.querySelector(".boton-principal");
          boton.classList.add("exito-animado");
          setTimeout(() => boton.classList.remove("exito-animado"), 1500);
        }

        delete window[callbackName];
      };

      const params = new URLSearchParams(datos);
      params.append("callback", callbackName);

      const script = document.createElement("script");
      script.src = `${URL_SCRIPT}?${params.toString()}`;
      document.body.appendChild(script);
    });

    // === Fecha del footer ===
    document.getElementById("fechaFooter").textContent = new Date().toLocaleDateString("es-MX", {
      day: "2-digit", month: "long", year: "numeric"
    });
  </script>
</body>
</html>
