<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Diario - HRPV Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="../main_css/estilos.css" rel="stylesheet">
    <style>
        .form-page {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary), var(--color-accent));
            min-height: 100vh;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Poppins', sans-serif;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 480px;
            position: relative;
            overflow: hidden;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-accent), var(--color-success));
        }

        .form-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .form-header h1 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .form-header h1 i {
            color: var(--color-accent);
            font-size: 2.2rem;
        }

        .form-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin: 0;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 1.8rem;
            position: relative;
        }

        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-label i {
            width: 20px;
            text-align: center;
            color: var(--color-accent);
        }

        .form-select,
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 14px 18px;
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.07);
            color: white;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-select:hover,
        .form-input:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.1);
        }

        .form-select:focus,
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
            transform: translateY(-1px);
        }

        .form-select option {
            background: #2c3e50;
            color: white;
            padding: 10px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--color-accent), #2980b9);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .success-message {
            background: rgba(46, 204, 113, 0.15);
            border: 1.5px solid rgba(46, 204, 113, 0.4);
            color: white;
            padding: 1.2rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 1.5rem;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .success-message i {
            color: #2ecc71;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            margin-top: 2rem;
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .back-link:hover {
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(-5px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="form-page">
    <div class="glass" id="dashboard">
        <h5>Reporte de Actividades</h5>
        <div class="header">
            <div class="logo">
                <a href="/estadisticas"> <img src="../img/logo-hrpv.png" alt="Logo" width="120"></a>
            </div>
            <div>
                <div class="usuario">
                    <i class="fa-solid fa-user-circle"></i>
                    <span id="user-info"></span>
                    <!-- Bot√≥n de cerrar sesi√≥n -->
                    <button onclick="cerrarSesion()" class="btn-salir-ultra">
                        Salir
                    </button>
                </div>
            </div>
        </div>

        <form id="reporteForm">
            <!-- Persona -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-user-tie"></i> Responsable
                </label>
                <select class="form-select" id="persona" required>
                    <option value="">Selecciona tu nombre</option>
                    <option value="Fernanda">üë©‚Äçüíº Fernanda</option>
                    <option value="Lolita">üë©‚Äçüíª Lolita</option>
                    <option value="Elda">üë®‚Äçüíª Elda</option>
                    <option value="Isela">üë©‚Äçüéì Isela</option>
                    <option value="Lucero">üë©‚Äçüéì Lucero</option>
                    <option value="Kenya">üë©‚Äçüéì Kenya</option>
                    <option value="Cintia">üë©‚Äçüéì Cintia</option>
                    <option value="Yolanda">üë©‚Äçüéì Yolanda</option>
                    <option value="Ruth">üë©‚Äçüéì Ruth</option>
                    <option value="Freddy">üë®‚Äçüíº Freddy</option>
                    <option value="Aldo">üë®‚Äçüíº Aldo</option>
                    <option value="Omar">üë®‚Äçüíº Omar</option>
                </select>
            </div>

            <!-- Tarea -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-list-check"></i> Tarea Realizada
                </label>
                <select class="form-select" id="tarea" required>
                    <option value="">Selecciona la actividad</option>
                    <option value="Validaci√≥n CIE-10">üîç Validaci√≥n CIE-10</option>
                    <option value="Captura en SINBA">üíª Captura en SINBA</option>
                    <option value="Concentrado de servicios">üìä Concentrado de servicios</option>
                    <option value="Informe mensual">üìà Informe mensual</option>
                    <option value="Env√≠o digital y respaldo">üì§ Env√≠o digital y respaldo</option>
                    <option value="Supervisi√≥n y retroalimentaci√≥n">üëÅÔ∏è Supervisi√≥n y retroalimentaci√≥n</option>
                    <option value="Integraci√≥n de observaciones jurisdiccionales">üîó Integraci√≥n de observaciones
                        jurisdiccionales</option>
                    <option value="Valer VERSACE..">‚ö° Valer VERSACE..</option>
                </select>
            </div>

            <!-- Documentos Trabajados -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-file-circle-check"></i> Documentos Procesados
                </label>
                <input type="number" class="form-input" id="documentos" placeholder="Ej: 25, 150, 340..." min="0"
                    max="10000" required>
            </div>

            <!-- Observaciones -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-comment-dots"></i> Observaciones
                </label>
                <textarea class="form-input form-textarea" id="observaciones"
                    placeholder="Detalles relevantes del avance (opcional)..."></textarea>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                <i class="fa-solid fa-paper-plane"></i> Registrar Avance
            </button>

            <div id="successMessage" class="success-message">
                <i class="fa-solid fa-check-circle"></i>
                <div style="font-weight: 600; margin-bottom: 5px;">¬°Reporte Guardado!</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">El registro se ha actualizado en el sistema</div>
            </div>
        </form>

        <a href="/estadisticas" class="back-link">
            <i class="fa-solid fa-arrow-left"></i> Inicio
        </a>
    </div>

    <script>
        // URL de tu GAS - REEMPLAZA CON TU URL REAL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw5lrSCqUScFDhgcGvSgkiWdTte_as7rcwqVcAp8MCfjPvOrvBIDO-gUSfbJEOCVjET/exec";

        document.getElementById('reporteForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const originalHTML = submitBtn.innerHTML;

            // Deshabilitar y mostrar loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin pulse"></i> Guardando en sistema...';

            const formData = {
                fecha: new Date().toISOString().split('T')[0], // YYYY-MM-DD
                persona: document.getElementById('persona').value,
                tarea: document.getElementById('tarea').value,
                documentos: document.getElementById('documentos').value,
                observaciones: document.getElementById('observaciones').value
            };

            console.log('üöÄ Enviando datos premium:', formData);

            // Usar JSONP para evitar CORS
            const callbackName = 'formCallback_' + Date.now();

            window[callbackName] = function (response) {
                console.log('üì• Respuesta del servidor:', response);

                // Limpiar
                delete window[callbackName];
                const script = document.querySelector(`script[src*="${callbackName}"]`);
                if (script) script.remove();

                // Restaurar bot√≥n
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalHTML;

                if (response && response.success) {
                    // √âXITO - Mostrar confirmaci√≥n
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('reporteForm').reset();

                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                    }, 4000);

                } else {
                    // ERROR
                    alert('‚ùå Error: ' + (response.error || 'No se pudo guardar el reporte'));
                }
            };

            // Crear script JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                ...formData,
                callback: callbackName
            });

            script.src = `${GAS_URL}?${params.toString()}`;
            console.log('üîó URL llamada:', script.src);

            script.onerror = function () {
                console.error('‚ùå Error de conexi√≥n');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalHTML;
                alert('üö® Error de conexi√≥n. Verifica tu internet.');
                delete window[callbackName];
            };

            document.head.appendChild(script);

            // Timeout de seguridad
            setTimeout(() => {
                if (window[callbackName]) {
                    console.warn('‚è∞ Timeout del formulario');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalHTML;
                    alert('‚è∞ El servidor no respondi√≥. Intenta nuevamente.');
                    delete window[callbackName];
                }
            }, 10000);
        });

        // Efectos de focus mejorados
        document.querySelectorAll('.form-select, .form-input, .form-textarea').forEach(input => {
            input.addEventListener('focus', function () {
                this.parentElement.style.transform = 'translateY(-2px)';
            });

            input.addEventListener('blur', function () {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });

        // Auto-focus en el primer campo
        document.getElementById('persona').focus();
    </script>
</body>

</html>