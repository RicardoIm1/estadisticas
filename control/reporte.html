<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Diario - HRPV Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link href="../main_css/estilos.css" rel="stylesheet">

    <style>
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .usuario {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-salir-ultra {
            background: transparent;
            border: 1px solid var(--color-accent);
            border-radius: 8px;
            color: var(--color-accent);
            padding: 0.3rem 0.6rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-salir-ultra:hover {
            background: var(--color-accent);
            color: #0b1724;
        }

        .form-input,
        .form-textarea {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--color-text);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
            width: 100%;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            background: rgba(255, 255, 255, 0.12);
        }


        /* ================================
   üåå ESTILO PREMIUM UNIFICADO
   Autor: Rick
   Descripci√≥n: base visual para todos los paneles
================================ */

        /* --- VARIABLES DE COLOR Y SOMBRA --- */
        :root {
            --color-primary: #00b4d8;
            --color-accent: #90e0ef;
            --color-bg-dark: #0b1724;
            --color-bg-light: rgba(255, 255, 255, 0.08);
            --color-text: #e9ecef;
            --color-success: #4caf50;
            --color-error: #e63946;
            --blur-strength: 20px;
            --radius: 24px;
            --transition: 0.3s ease;
        }

        /* --- RESETEO BASE --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            font-family: 'Poppins', sans-serif;
            color: var(--color-text);
            background: radial-gradient(circle at top, #1a2a3a, #0b1724);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .glass {
            background: var(--color-bg-light);
            backdrop-filter: blur(var(--blur-strength));
            border-radius: var(--radius);
            box-shadow: 0 0 60px rgba(0, 0, 0, 0.3);
            padding: 3rem 2rem;
            max-width: 420px;
            width: 90%;
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            transition: var(--transition);
        }

        .glass:hover {
            transform: translateY(-4px);
            box-shadow: 0 0 80px rgba(0, 180, 216, 0.3);
        }

        /* --- FORMULARIOS --- */
        form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-control,
        .form-select {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--color-text);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-accent);
            background: rgba(255, 255, 255, 0.12);
        }

        /* --- BOTONES --- */
        .submit-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.9rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .submit-btn:hover {
            background: var(--color-accent);
            transform: scale(1.03);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- EFECTO SPINNER / LATIDO --- */
        .submit-btn:disabled i.fa-spinner {
            animation: pulse 1s infinite ease-in-out;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* --- MENSAJES DE ESTADO --- */
        #successMessage,
        #errorMessage {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        #successMessage {
            color: var(--color-success);
            animation: pulseSuccess 1s ease;
        }

        #errorMessage {
            color: var(--color-error);
        }

        @keyframes pulseSuccess {
            0% {
                transform: scale(0.9);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }

            100% {
                transform: scale(1);
            }
        }

        /* --- T√çTULOS Y ENCABEZADOS --- */
        h1,
        h2,
        h3 {
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- RESPONSIVIDAD --- */
        @media (max-width: 480px) {
            .glass {
                padding: 2rem 1.5rem;
            }

            .submit-btn {
                font-size: 1rem;
                padding: 0.8rem;
            }
        }

        /* --- ELEMENTOS COMPLEMENTARIOS --- */
        .form-select option {
            color: white;
            background-color: #1f2b38;
        }

        a,
        .link {
            color: var(--color-accent);
            text-decoration: none;
            transition: var(--transition);
        }

        a:hover,
        .link:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }
    </style>
</head>

<body class="form-page">
    <div class="glass" id="dashboard">
        <div id="message" style="text-align:center; margin-top:1rem;"></div>

        <h5>Reporte de Actividades</h5>
        <div class="header">
            <div class="logo">
                <a href="/estadisticas"> <img src="../img/logo-hrpv.png" alt="Logo" width="120"></a>
            </div>
            <div>
                <div class="usuario">
                    <i class="fa-solid fa-user-circle"></i>
                    <span id="user-info"></span>
                    <!-- Bot√≥n de cerrar sesi√≥n -->
                    <button onclick="cerrarSesion()" class="btn-salir-ultra">
                        Salir
                    </button>
                </div>
            </div>
        </div>

        <form id="reporteForm">
            <!-- Persona -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-user-tie"></i> Responsable
                </label>
                <select class="form-select" id="persona" required>
                    <option value="">Selecciona tu nombre</option>
                    <option value="Fernanda">üë©‚Äçüíº Fernanda</option>
                    <option value="Lolita">üë©‚Äçüíª Lolita</option>
                    <option value="Elda">üë®‚Äçüíª Elda</option>
                    <option value="Isela">üë©‚Äçüéì Isela</option>
                    <option value="Lucero">üë©‚Äçüéì Lucero</option>
                    <option value="Kenya">üë©‚Äçüéì Kenya</option>
                    <option value="Cintia">üë©‚Äçüéì Cintia</option>
                    <option value="Yolanda">üë©‚Äçüéì Yolanda</option>
                    <option value="Ruth">üë©‚Äçüéì Ruth</option>
                    <option value="Freddy">üë®‚Äçüíº Freddy</option>
                    <option value="Aldo">üë®‚Äçüíº Aldo</option>
                    <option value="Omar">üë®‚Äçüíº Omar</option>
                </select>
            </div>

            <!-- Tarea -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-list-check"></i> Tarea Realizada
                </label>
                <select class="form-select" id="tarea" required>
                    <option value="">Selecciona la actividad</option>
                    <option value="Validaci√≥n CIE-10">üîç Validaci√≥n CIE-10</option>
                    <option value="Captura en SINBA">üíª Captura en SINBA</option>
                    <option value="Concentrado de servicios">üìä Concentrado de servicios</option>
                    <option value="Informe mensual">üìà Informe mensual</option>
                    <option value="Env√≠o digital y respaldo">üì§ Env√≠o digital y respaldo</option>
                    <option value="Supervisi√≥n y retroalimentaci√≥n">üëÅÔ∏è Supervisi√≥n y retroalimentaci√≥n</option>
                    <option value="Integraci√≥n de observaciones jurisdiccionales">üîó Integraci√≥n de observaciones
                        jurisdiccionales</option>
                    <option value="Valer VERSACE..">‚ö° Valer VERSACE..</option>
                </select>
            </div>

            <!-- Documentos Trabajados -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-file-circle-check"></i> Documentos Procesados
                </label>
                <input type="number" class="form-input" id="documentos" placeholder="Ej: 25, 150, 340..." min="0"
                    max="10000" required>
            </div>

            <!-- Observaciones -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fa-solid fa-comment-dots"></i> Observaciones
                </label>
                <textarea class="form-input form-textarea" id="observaciones"
                    placeholder="Detalles relevantes del avance (opcional)..."></textarea>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                <i class="fa-solid fa-paper-plane"></i> Registrar Avance
            </button>

            <div id="successMessage" class="success-message">
                <i class="fa-solid fa-check-circle"></i>
                <div style="font-weight: 600; margin-bottom: 5px;">¬°Reporte Guardado!</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">El registro se ha actualizado en el sistema</div>
            </div>
        </form>

        <a href="/estadisticas" class="back-link">
            <i class="fa-solid fa-arrow-left"></i> Inicio
        </a>
    </div>

    <script>
        // URL de tu GAS - REEMPLAZA CON TU URL REAL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw5lrSCqUScFDhgcGvSgkiWdTte_as7rcwqVcAp8MCfjPvOrvBIDO-gUSfbJEOCVjET/exec";

        document.getElementById('reporteForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const originalHTML = submitBtn.innerHTML;

            // Deshabilitar y mostrar loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin pulse"></i> Guardando en sistema...';

            const formData = {
                fecha: new Date().toISOString().split('T')[0], // YYYY-MM-DD
                persona: document.getElementById('persona').value,
                tarea: document.getElementById('tarea').value,
                documentos: document.getElementById('documentos').value,
                observaciones: document.getElementById('observaciones').value
            };

            console.log('üöÄ Enviando datos premium:', formData);

            // Usar JSONP para evitar CORS
            const callbackName = 'formCallback_' + Date.now();

            window[callbackName] = function (response) {
                console.log('üì• Respuesta del servidor:', response);

                // Limpiar
                delete window[callbackName];
                const script = document.querySelector(`script[src*="${callbackName}"]`);
                if (script) script.remove();

                // Restaurar bot√≥n
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalHTML;

                if (response && response.success) {
                    // √âXITO - Mostrar confirmaci√≥n
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('reporteForm').reset();

                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                    }, 4000);

                } else {
                    // ERROR
                    alert('‚ùå Error: ' + (response.error || 'No se pudo guardar el reporte'));
                }
            };

            // Crear script JSONP
            const script = document.createElement('script');
            const params = new URLSearchParams({
                ...formData,
                callback: callbackName
            });

            script.src = `${GAS_URL}?${params.toString()}`;
            console.log('üîó URL llamada:', script.src);

            script.onerror = function () {
                console.error('‚ùå Error de conexi√≥n');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalHTML;
                alert('üö® Error de conexi√≥n. Verifica tu internet.');
                delete window[callbackName];
            };

            document.head.appendChild(script);

            // Timeout de seguridad
            setTimeout(() => {
                if (window[callbackName]) {
                    console.warn('‚è∞ Timeout del formulario');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalHTML;
                    alert('‚è∞ El servidor no respondi√≥. Intenta nuevamente.');
                    delete window[callbackName];
                }
            }, 10000);
        });

        // Efectos de focus mejorados
        document.querySelectorAll('.form-select, .form-input, .form-textarea').forEach(input => {
            input.addEventListener('focus', function () {
                this.parentElement.style.transform = 'translateY(-2px)';
            });

            input.addEventListener('blur', function () {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });

        // Auto-focus en el primer campo
        document.getElementById('persona').focus();
    </script>
    <script src="../main_js/estadoSistema.js"></script>

</body>

</html>