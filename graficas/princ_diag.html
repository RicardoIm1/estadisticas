<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Principales Diagn칩sticos</title>
    <link rel="shortcut icon" href="/estadisticas/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/estadisticas/img/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: #1e293b;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.2);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 900px;
        }

        .controls-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1e40af;
            font-size: 0.95rem;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s;
        }

        select:focus {
            border-color: #1e40af;
            outline: none;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            grid-column: span 2;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(30, 64, 175, 0.2);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            border-top: 4px solid;
        }

        .metric-card:nth-child(1) {
            border-color: #3b82f6;
        }

        .metric-card:nth-child(2) {
            border-color: #10b981;
        }

        .metric-card:nth-child(3) {
            border-color: #f59e0b;
        }

        .metric-card:nth-child(4) {
            border-color: #ef4444;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            color: #1e293b;
        }

        .metric-label {
            color: #64748b;
            font-size: 0.95rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .chart-card:hover {
            transform: translateY(-5px);
        }

        .chart-title {
            font-size: 1.3rem;
            color: #1e40af;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            height: 400px;
            position: relative;
        }

        .data-table-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #f8fafc;
            color: #1e40af;
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
        }

        td {
            padding: 14px 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        tr:hover {
            background: #f8fafc;
        }

        .concept-tag {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
            background: #e0e7ff;
            color: #3730a3;
        }

        .concept-egresos {
            background: #dbeafe;
            color: #1e40af;
        }

        .concept-urgencias {
            background: #dcfce7;
            color: #166534;
        }

        .concept-aafecciones {
            background: #fef3c7;
            color: #92400e;
        }

        .concept-externas {
            background: #fce7f3;
            color: #9d174d;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-card {
                padding: 20px;
            }

            .controls-panel {
                grid-template-columns: 1fr;
            }

            button {
                grid-column: 1;
            }

            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Principales diagn칩sticos</h1>
            <p class="subtitle">An치lisis comparativo de las principales causas de atenci칩n hospitalaria 2024-2025</p>
        </header>

        <div class="controls-panel">
            <div class="filter-group">
                <label for="filter-concepto">Tipo de Atenci칩n:</label>
                <select id="filter-concepto">
                    <option value="all">Todos los tipos</option>
                    <option value="EGRESOS">Egresos Hospitalarios</option>
                    <option value="URGENCIAS">Urgencias</option>
                    <option value="AFECCIONES">Afecciones en Lesiones</option>
                    <option value="EXTERNAS">Causas Externas</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-year">A침o:</label>
                <select id="filter-year">
                    <option value="all">Ambos a침os</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-top">Mostrar Top:</label>
                <select id="filter-top">
                    <option value="10">Top 10</option>
                    <option value="15">Top 15</option>
                    <option value="20">Top 20</option>
                    <option value="all">Todos</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-chart">Tipo de Gr치fico:</label>
                <select id="filter-chart">
                    <option value="bar">Barras</option>
                    <option value="line">L칤neas</option>
                    <option value="pie">Pastel</option>
                </select>
            </div>

            <button id="update-btn">Actualizar Dashboard</button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Total de Casos</div>
                <div class="metric-value" id="total-cases">0</div>
                <div class="metric-label" id="total-change">Carga total del sistema</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Causa M치s Frecuente</div>
                <div class="metric-value" id="top-cause">-</div>
                <div class="metric-label" id="top-volume">Volumen</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Promedio por Causa</div>
                <div class="metric-value" id="avg-per-cause">0</div>
                <div class="metric-label">Casos promedio</div>
            </div>

            <div class="metric-card">
                <div class="metric-label">Variaci칩n 2024-2025</div>
                <div class="metric-value" id="year-change">0%</div>
                <div class="metric-label" id="change-direction">Crecimiento/Reducci칩n</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h2 class="chart-title"><i>游늵</i> Distribuci칩n por Tipo de Atenci칩n</h2>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title"><i>游늳</i> Evoluci칩n Temporal por A침o</h2>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title"><i>游끥</i> Principales Causas Espec칤ficas</h2>
                <div class="chart-container">
                    <canvas id="causesChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title"><i>游댌</i> Comparativa Anual Detallada</h2>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </div>

        <div class="data-table-container">
            <h2 class="chart-title"><i>游늶</i> Base de Datos Epidemiol칩gica</h2>
            <div id="table-loading">Cargando datos estad칤sticos...</div>
            <table id="data-table" style="display: none;">
                <thead>
                    <tr>
                        <th>Tipo de Atenci칩n</th>
                        <th>A침o</th>
                        <th>Causa Espec칤fica</th>
                        <th>Volumen de Casos</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>

        <footer>
            <p>춸 2024 Sistema de Monitoreo Epidemiol칩gico Hospitalario | Datos estad칤sticos 2024-2025</p>
            <p>Visualizaci칩n desarrollada con Chart.js para an치lisis de salud p칰blica</p>
        </footer>
    </div>

    <script>
        // DATOS COMPLETOS con TODAS las categor칤as
        const hospitalData = [
            // =========== EGRESOS HOSPITALARIOS 2024 ===========
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "160 Causas obst칠tricas directas, excepto aborto y parto 칰nico espont치neo (solo morbilidad)", volumen: 324 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "166 Traumatismos, envenenamientos y algunas otras consecuencias de causas externas", volumen: 276 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "161 Parto 칰nico espont치neo", volumen: 201 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "159 Aborto (solo morbilidad)", volumen: 127 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "163 Ciertas afecciones originadas en el per칤odo perinatal", volumen: 95 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "119 Apendicitis", volumen: 74 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "126 Colelitiasis y colecistitis", volumen: 56 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "061 Diabetes mellitus", volumen: 55 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "120 Hernia de la cavidad abdominal", volumen: 43 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "097 Enfermedades del coraz칩n", volumen: 43 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "036 Fiebre del dengue hemorr치gico", volumen: 36 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "128 Infecciones de la piel y del tejido subcut치neo", volumen: 30 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "105 Neumon칤a e influenza", volumen: 29 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "098 Enfermedades cerebrovasculares", volumen: 28 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "125 Enfermedades del h칤gado", volumen: 24 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "058 Anemias", volumen: 19 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "053 Leiomioma uterino", volumen: 19 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "184 Personas en contacto con los servicios de salud para procedimientos espec칤ficos y atenci칩n de la salud", volumen: 19 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "015 Septicemia", volumen: 18 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "139 Insuficiencia renal", volumen: 18 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "Las dem치s de las Principales", volumen: 201 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "S칤ntomas signos y hallazgos anormales cl칤nicos y de laboratorio no clasificados en otra parte", volumen: 17 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2024, causa: "Las dem치s", volumen: 167 },

            // =========== EGRESOS HOSPITALARIOS 2025 ===========
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "166 Traumatismos, envenenamientos y algunas otras consecuencias de causas externas", volumen: 272 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "160 Causas obst칠tricas directas, excepto aborto y parto 칰nico espont치neo (solo morbilidad)", volumen: 253 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "161 Parto 칰nico espont치neo", volumen: 223 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "159 Aborto (solo morbilidad)", volumen: 122 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "163 Ciertas afecciones originadas en el per칤odo perinatal", volumen: 83 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "061 Diabetes mellitus", volumen: 71 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "126 Colelitiasis y colecistitis", volumen: 60 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "097 Enfermedades del coraz칩n", volumen: 51 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "119 Apendicitis", volumen: 50 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "105 Neumon칤a e influenza", volumen: 39 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "120 Hernia de la cavidad abdominal", volumen: 37 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "128 Infecciones de la piel y del tejido subcut치neo", volumen: 32 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "098 Enfermedades cerebrovasculares", volumen: 27 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "125 Enfermedades del h칤gado", volumen: 21 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "015 Septicemia", volumen: 20 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "049 Tumores malignos", volumen: 17 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "127 Pancreatitis aguda y otras enfermedades del p치ncreas", volumen: 16 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "081 Epilepsia", volumen: 15 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "139 Insuficiencia renal", volumen: 13 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "184 Personas en contacto con los servicios de salud para procedimientos espec칤ficos y atenci칩n de la salud", volumen: 13 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "Las dem치s de las Principales", volumen: 178 },
            { concepto: "PRINCIPALES CAUSAS DE EGRESOS HOSPITALARIOS", a침o: 2025, causa: "Las dem치s", volumen: 188 },

            // =========== URGENCIAS 2024 ===========
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "166 Traumatismos, envenenamientos y algunas otras consecuencias de causas externas", volumen: 2018 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "179 Supervisi칩n de embarazo normal", volumen: 1293 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "160 Causas obst칠tricas directas, excepto aborto y parto 칰nico espont치neo (solo morbilidad)", volumen: 405 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "104 Infecciones respiratorias agudas, excepto neumon칤a e influenza", volumen: 362 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "126 Colelitiasis y colecistitis", volumen: 261 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "001 Enfermedades infecciosas intestinales", volumen: 244 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "128 Infecciones de la piel y del tejido subcut치neo", volumen: 152 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "097 Enfermedades del coraz칩n", volumen: 144 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "061 Diabetes mellitus", volumen: 139 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "124 S칤ndrome del colon irritable y otros trastornos funcionales del intestino", volumen: 135 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "159 Aborto (solo morbilidad)", volumen: 107 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "119 Apendicitis", volumen: 106 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "184 Personas en contacto con los servicios de salud para procedimientos espec칤ficos y atenci칩n de la salud", volumen: 100 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "110 Bronquitis cr칩nica, enfisema y asma", volumen: 88 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "035 Fiebre del dengue", volumen: 84 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "073 Trastornos neur칩ticos, trastornos relacionados con el estr칠s y trastornos somatomorfos", volumen: 76 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "135 Trastornos de los tejidos blandos", volumen: 75 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "117 Gastritis y duodenitis", volumen: 74 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "120 Hernia de la cavidad abdominal", volumen: 48 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "095 Otitis media, trastornos de la trompa de eustaquio y mastoiditis", volumen: 44 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "Las dem치s de las Principales", volumen: 694 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "S칤ntomas signos y hallazgos anormales cl칤nicos y de laboratorio no clasificados en otra parte", volumen: 703 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2024, causa: "Las dem치s", volumen: 812 },

            // =========== URGENCIAS 2025 ===========
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "166 Traumatismos, envenenamientos y algunas otras consecuencias de causas externas", volumen: 1924 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "179 Supervisi칩n de embarazo normal", volumen: 1162 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "160 Causas obst칠tricas directas, excepto aborto y parto 칰nico espont치neo (solo morbilidad)", volumen: 332 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "104 Infecciones respiratorias agudas, excepto neumon칤a e influenza", volumen: 311 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "001 Enfermedades infecciosas intestinales", volumen: 283 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "126 Colelitiasis y colecistitis", volumen: 186 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "097 Enfermedades del coraz칩n", volumen: 166 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "061 Diabetes mellitus", volumen: 148 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "128 Infecciones de la piel y del tejido subcut치neo", volumen: 147 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "124 S칤ndrome del colon irritable y otros trastornos funcionales del intestino", volumen: 139 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "159 Aborto (solo morbilidad)", volumen: 131 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "073 Trastornos neur칩ticos, trastornos relacionados con el estr칠s y trastornos somatomorfos", volumen: 86 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "110 Bronquitis cr칩nica, enfisema y asma", volumen: 70 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "119 Apendicitis", volumen: 64 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "135 Trastornos de los tejidos blandos", volumen: 59 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "117 Gastritis y duodenitis", volumen: 55 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "120 Hernia de la cavidad abdominal", volumen: 54 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "095 Otitis media, trastornos de la trompa de eustaquio y mastoiditis", volumen: 42 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "184 Personas en contacto con los servicios de salud para procedimientos espec칤ficos y atenci칩n de la salud", volumen: 42 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "142 C칩lico renal, no especificado", volumen: 40 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "Las dem치s de las Principales", volumen: 650 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "S칤ntomas signos y hallazgos anormales cl칤nicos y de laboratorio no clasificados en otra parte", volumen: 651 },
            { concepto: "PRINCIPALES CAUSAS DE URGENCIAS", a침o: 2025, causa: "Las dem치s", volumen: 864 },

            // =========== AFECCIONES EN LESIONES 2024 ===========
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "TRAUMATISMOS M칔LTIPLES, NO ESPECIFICADOS", volumen: 124 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "EFECTO T칍XICO DEL CONTACTO CON ANIMALES VENENOSOS", volumen: 93 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DE LA CABEZA", volumen: 56 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "TRAUMATISMO INTRACRANEAL", volumen: 30 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DE LA MU칌ECA Y DE LA MANO", volumen: 22 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DE LA PIERNA", volumen: 22 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA DEL ANTEBRAZO", volumen: 22 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA DE LA PIERNA, INCLUSIVE DEL TOBILLO", volumen: 15 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DEL HOMBRO Y DEL BRAZO", volumen: 13 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DEL TOBILLO Y DEL PIE", volumen: 9 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "HERIDA DEL ANTEBRAZO Y DEL CODO", volumen: 8 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA DEL F칄MUR", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA DEL PIE, EXCEPTO DEL TOBILLO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "AMPUTACI칍N TRAUM츼TICA DE LA MU칌ECA Y DE LA MANO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA A NIVEL DE LA MU칌ECA Y DE LA MANO", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "LUXACI칍N, ESGUINCE Y TORCEDURA DE ARTICULACIONES Y LIGAMENTOS DEL CUELLO", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "FRACTURA DE LAS COSTILLAS, DEL ESTERN칍N Y DE LA COLUMNA TOR츼CICA [DORSAL]", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "LUXACI칍N, ESGUINCE Y TORCEDURA DE ARTICULACIONES Y LIGAMENTOS DEL TOBILLO Y DEL PIE", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "TRAUMATISMO SUPERFICIAL DEL TOBILLO Y DEL PIE", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "TRAUMATISMO SUPERFICIAL DE LA PIERNA", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2024, causa: "LAS DEM츼S LESIONES", volumen: 73 },

            // =========== AFECCIONES EN LESIONES 2025 ===========
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMOS M칔LTIPLES, NO ESPECIFICADOS", volumen: 75 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "EFECTO T칍XICO DEL CONTACTO CON ANIMALES VENENOSOS", volumen: 62 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DE LA CABEZA", volumen: 58 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMO INTRACRANEAL", volumen: 29 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DE LA MU칌ECA Y DE LA MANO", volumen: 24 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA DE LA PIERNA, INCLUSIVE DEL TOBILLO", volumen: 22 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMO SUPERFICIAL DE LA CABEZA", volumen: 19 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DEL TOBILLO Y DEL PIE", volumen: 18 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DE LA PIERNA", volumen: 16 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMOS SUPERFICIALES QUE AFECTAN M칔LTIPLES REGIONES DEL CUERPO", volumen: 13 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "LUXACI칍N, ESGUINCE Y TORCEDURA DE ARTICULACIONES Y LIGAMENTOS DEL TOBILLO Y DEL PIE", volumen: 11 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA DEL F칄MUR", volumen: 9 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA DEL ANTEBRAZO", volumen: 9 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DEL HOMBRO Y DEL BRAZO", volumen: 9 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMO DE REGIONES NO ESPECIFICADAS DEL CUERPO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "HERIDA DEL ANTEBRAZO Y DEL CODO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "TRAUMATISMO SUPERFICIAL DEL ANTEBRAZO Y DEL CODO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA DEL PIE, EXCEPTO DEL TOBILLO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA DEL HOMBRO Y DEL BRAZO", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "FRACTURA A NIVEL DE LA MU칌ECA Y DE LA MANO", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS DE AFECCIONES EN LESIONES", a침o: 2025, causa: "LAS DEM츼S LESIONES", volumen: 81 },

            // =========== CAUSAS EXTERNAS EN LESIONES 2024 ===========
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "MOTOCICLISTA LESIONADO EN OTROS ACCIDENTES DE TRANSPORTE, Y EN LOS NO ESPECIFICADOS", volumen: 114 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CONTACTO TRAUM츼TICO CON ESCORPI칍N", volumen: 88 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CA칈DA EN EL MISMO NIVEL POR DESLIZAMIENTO, TROPEZ칍N Y TRASPI칄", volumen: 63 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "AGRESI칍N CON FUERZA CORPORAL", volumen: 62 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "MORDEDURA O ATAQUE DE PERRO", volumen: 16 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "AGRESI칍N CON OBJETO ROMO O SIN FILO", volumen: 15 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CONTACTO TRAUM츼TICO CON OBJETO CORTANTE, DE INTENCI칍N NO DETERMINADA", volumen: 15 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "APORREO, GOLPE, MORDEDURA, PATADA, RASGU칌O O TORCEDURA INFLIGIDOS POR OTRA PERSONA", volumen: 10 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CONTACTO TRAUM츼TICO CON VIDRIO CORTANTE", volumen: 9 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "GOLPE CONTRA O GOLPEADO POR OTROS OBJETOS", volumen: 8 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CONTACTO TRAUM츼TICO CON OBJETO ROMO O SIN FILO, DE INTENCI칍N NO DETERMINADA", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "OCUPANTE DE AUTOM칍VIL LESIONADO EN OTROS ACCIDENTES DE TRANSPORTE, Y EN LOS NO ESPECIFICADOS", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "OCUPANTE DE AUTOM칍VIL LESIONADO POR COLISI칍N CON PEAT칍N O ANIMAL", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "EXPOSICI칍N A OTRAS FUERZAS MEC츼NICAS INANIMADAS, Y LAS NO ESPECIFICADAS", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CA칈DA DESDE, FUERA O A TRAV칄S DE UN EDIFICIO U OTRA CONSTRUCCI칍N", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "PEAT칍N LESIONADO POR COLISI칍N CON VEH칈CULO DE PEDAL", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "PEAT칍N LESIONADO POR COLISI칍N CON VEH칈CULO DE MOTOR DE DOS O TRES RUEDAS", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CA칈DA EN O DESDE ESCALERA O ESCALONES", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "CA칈DA EN O DESDE ESCALERA MANUALES", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "ATRAPADO, APLASTADO, TRABADO O APRETADO EN O ENTRE OBJETOS", volumen: 4 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2024, causa: "LAS DEM츼S LESIONES", volumen: 84 },

            // =========== CAUSAS EXTERNAS EN LESIONES 2025 ===========
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "AGRESI칍N CON FUERZA CORPORAL", volumen: 64 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "MOTOCICLISTA LESIONADO EN OTROS ACCIDENTES DE TRANSPORTE, Y EN LOS NO ESPECIFICADOS", volumen: 58 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CA칈DA EN EL MISMO NIVEL POR DESLIZAMIENTO, TROPEZ칍N Y TRASPI칄", volumen: 48 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CONTACTO TRAUM츼TICO CON ESCORPI칍N", volumen: 38 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CONTACTO TRAUM츼TICO CON OTROS OBJETOS AFILADOS", volumen: 21 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "OTROS MALTRATOS", volumen: 17 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "AGRESI칍N CON OBJETO ROMO O SIN FILO", volumen: 15 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "MORDEDURA O ATAQUE DE PERRO", volumen: 14 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "MOTOCICLISTA LESIONADO EN ACCIDENTE DE TRANSPORTE SIN COLISI칍N", volumen: 13 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CONTACTO TRAUM츼TICO CON OTROS ANIMALES VENENOSOS ESPECIFICADOS", volumen: 12 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CA칈DA EN O DESDE ESCALERA O ESCALONES", volumen: 12 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "GOLPE CONTRA O GOLPEADO POR OTROS OBJETOS", volumen: 10 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CONTACTO TRAUM츼TICO CON VIDRIO CORTANTE", volumen: 8 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CA칈DA NO ESPECIFICADA", volumen: 8 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CA칈DA DESDE, FUERA O A TRAV칄S DE UN EDIFICIO U OTRA CONSTRUCCI칍N", volumen: 8 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "AGRESI칍N CON OBJETO CORTANTE", volumen: 7 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "MOTOCICLISTA LESIONADO POR COLISI칍N CON AUTOM칍VIL, CAMIONETA O FURGONETA", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "GOLPE POR OBJETO ARROJADO, PROYECTADO O QUE CAE", volumen: 6 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "OCUPANTE DE AUTOM칍VIL LESIONADO EN OTROS ACCIDENTES DE TRANSPORTE, Y EN LOS NO ESPECIFICADOS", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "CONTACTO TRAUM츼TICO CON ANIMALES Y PLANTAS VENENOSOS NO ESPECIFICADOS", volumen: 5 },
            { concepto: "PRINCIPALES CAUSAS EXTERNAS EN LESIONES", a침o: 2025, causa: "LAS DEM츼S LESIONES", volumen: 121 }
        ];

        let filteredData = [...hospitalData];
        let charts = {};

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function () {
            initDashboard();
            setupEventListeners();
        });

        function initDashboard() {
            updateMetrics();
            renderCharts();
            populateTable();
        }

        function updateMetrics() {
            // Total de casos
            const totalCases = filteredData.reduce((sum, item) => sum + item.volumen, 0);
            document.getElementById('total-cases').textContent = totalCases.toLocaleString();

            // Causa m치s frecuente
            const topCause = filteredData.reduce((max, item) =>
                item.volumen > max.volumen ? item : max,
                { volumen: 0, causa: '-' }
            );
            document.getElementById('top-cause').textContent =
                topCause.causa.split(' ')[0]; // Solo el c칩digo o primera palabra
            document.getElementById('top-volume').textContent =
                `${topCause.volumen.toLocaleString()} casos`;

            // Promedio por causa
            const avgPerCause = totalCases / filteredData.length;
            document.getElementById('avg-per-cause').textContent = avgPerCause.toFixed(0);

            // Variaci칩n anual
            const year2024 = hospitalData.filter(d => d.a침o === 2024)
                .reduce((s, d) => s + d.volumen, 0);
            const year2025 = hospitalData.filter(d => d.a침o === 2025)
                .reduce((s, d) => s + d.volumen, 0);
            const change = ((year2025 - year2024) / year2024 * 100).toFixed(1);
            document.getElementById('year-change').textContent =
                Math.abs(change) + '%';
            document.getElementById('change-direction').textContent =
                change >= 0 ? 'Crecimiento' : 'Reducci칩n';
            document.getElementById('year-change').style.color =
                change >= 0 ? '#10b981' : '#ef4444';
        }

        function renderCharts() {
            renderDistributionChart();
            renderTrendChart();
            renderCausesChart();
            renderComparisonChart();
        }

        function renderDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');

            // Agrupar por tipo de atenci칩n
            const distribution = {
                'EGRESOS': 0,
                'URGENCIAS': 0,
                'AFECCIONES': 0,
                'EXTERNAS': 0
            };

            filteredData.forEach(item => {
                if (item.concepto.includes('EGRESOS')) distribution.EGRESOS += item.volumen;
                else if (item.concepto.includes('URGENCIAS')) distribution.URGENCIAS += item.volumen;
                else if (item.concepto.includes('AFECCIONES')) distribution.AFECCIONES += item.volumen;
                else if (item.concepto.includes('EXTERNAS')) distribution.EXTERNAS += item.volumen;
            });

            const labels = Object.keys(distribution);
            const data = Object.values(distribution);
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];

            if (charts.distributionChart) charts.distributionChart.destroy();

            const chartType = document.getElementById('filter-chart').value;

            charts.distributionChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.8', '1')),
                        borderWidth: 2,
                        label: 'Casos por Tipo'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');

            // Agrupar por a침o
            const years = [2024, 2025];
            const tipos = ['EGRESOS', 'URGENCIAS', 'AFECCIONES', 'EXTERNAS'];

            const datasets = tipos.map(tipo => {
                const data = years.map(year => {
                    return filteredData
                        .filter(d => d.a침o === year &&
                            d.concepto.includes(tipo === 'EGRESOS' ? 'EGRESOS' :
                                tipo === 'URGENCIAS' ? 'URGENCIAS' :
                                    tipo === 'AFECCIONES' ? 'AFECCIONES' : 'EXTERNAS'))
                        .reduce((sum, d) => sum + d.volumen, 0);
                });

                const colors = {
                    'EGRESOS': '#3b82f6',
                    'URGENCIAS': '#10b981',
                    'AFECCIONES': '#f59e0b',
                    'EXTERNAS': '#ef4444'
                };

                return {
                    label: tipo,
                    data: data,
                    borderColor: colors[tipo],
                    backgroundColor: colors[tipo] + '20',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.3
                };
            });

            if (charts.trendChart) charts.trendChart.destroy();

            charts.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N칰mero de Casos'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function renderCausesChart() {
            const ctx = document.getElementById('causesChart').getContext('2d');

            // Tomar top N causas
            const topN = parseInt(document.getElementById('filter-top').value) || 10;
            const sortedData = [...filteredData]
                .sort((a, b) => b.volumen - a.volumen)
                .slice(0, topN);

            // Acortar nombres para mejor visualizaci칩n
            const labels = sortedData.map(item => {
                const match = item.causa.match(/^(\d+)\s+(.+)/);
                if (match) {
                    return `${match[1]} ${match[2].substring(0, 25)}${match[2].length > 25 ? '...' : ''}`;
                }
                // Para lesiones, tomar las primeras palabras
                return item.causa.length > 30 ?
                    item.causa.substring(0, 30) + '...' :
                    item.causa;
            });

            const data = sortedData.map(item => item.volumen);

            // Color por tipo de atenci칩n
            const colors = sortedData.map(item => {
                if (item.concepto.includes('EGRESOS')) return '#3b82f6';
                if (item.concepto.includes('URGENCIAS')) return '#10b981';
                if (item.concepto.includes('AFECCIONES')) return '#f59e0b';
                if (item.concepto.includes('EXTERNAS')) return '#ef4444';
                return '#888';
            });

            if (charts.causesChart) charts.causesChart.destroy();

            const chartType = document.getElementById('filter-chart').value === 'pie' ? 'pie' : 'bar';

            charts.causesChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Volumen de Casos',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: chartType === 'bar' ? 'y' : 'x',
                    scales: chartType === 'bar' ? {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N칰mero de Casos'
                            }
                        }
                    } : {},
                    plugins: {
                        legend: {
                            display: chartType === 'pie',
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                title: function (context) {
                                    const index = context[0].dataIndex;
                                    return sortedData[index].causa;
                                },
                                label: function (context) {
                                    const value = context.parsed;
                                    const item = sortedData[context.dataIndex];
                                    return [
                                        `Volumen: ${value.toLocaleString()} casos`,
                                        `A침o: ${item.a침o}`,
                                        `Tipo: ${item.concepto.replace('PRINCIPALES CAUSAS DE ', '')}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');

            // Comparar causas espec칤ficas entre a침os
            const causasComunes = [
                'Traumatismos',
                'Causas obst칠tricas',
                'Parto 칰nico',
                'Aborto',
                'Ciertas afecciones',
                'Diabetes mellitus',
                'Enfermedades coraz칩n',
                'Infecciones piel'
            ];

            const data2024 = causasComunes.map(causa => {
                const found = filteredData.find(d =>
                    d.a침o === 2024 && d.causa.toLowerCase().includes(causa.toLowerCase())
                );
                return found ? found.volumen : 0;
            });

            const data2025 = causasComunes.map(causa => {
                const found = filteredData.find(d =>
                    d.a침o === 2025 && d.causa.toLowerCase().includes(causa.toLowerCase())
                );
                return found ? found.volumen : 0;
            });

            if (charts.comparisonChart) charts.comparisonChart.destroy();

            charts.comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: causasComunes,
                    datasets: [
                        {
                            label: '2024',
                            data: data2024,
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        },
                        {
                            label: '2025',
                            data: data2025,
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N칰mero de Casos'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function populateTable() {
            const tableBody = document.getElementById('table-body');
            const loading = document.getElementById('table-loading');
            const table = document.getElementById('data-table');

            tableBody.innerHTML = '';

            filteredData.forEach(item => {
                const row = document.createElement('tr');

                // Determinar clase del concepto
                let conceptClass = 'concept-tag';
                let conceptoShort = item.concepto.replace('PRINCIPALES CAUSAS DE ', '');

                if (item.concepto.includes('EGRESOS')) conceptClass += ' concept-egresos';
                else if (item.concepto.includes('URGENCIAS')) conceptClass += ' concept-urgencias';
                else if (item.concepto.includes('AFECCIONES')) conceptClass += ' concept-aafecciones';
                else if (item.concepto.includes('EXTERNAS')) conceptClass += ' concept-externas';

                row.innerHTML = `
                    <td><span class="${conceptClass}">${conceptoShort}</span></td>
                    <td><strong>${item.a침o}</strong></td>
                    <td>${item.causa}</td>
                    <td><strong style="color: ${item.volumen > 100 ? '#1e40af' : '#64748b'}">
                        ${item.volumen.toLocaleString()}
                    </strong></td>
                `;

                tableBody.appendChild(row);
            });

            loading.style.display = 'none';
            table.style.display = 'table';
        }

        function setupEventListeners() {
            document.getElementById('update-btn').addEventListener('click', updateDashboard);

            // Actualizar autom치ticamente al cambiar filtros
            ['filter-concepto', 'filter-year', 'filter-top', 'filter-chart'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateDashboard);
            });
        }

        function updateDashboard() {
            const conceptoFilter = document.getElementById('filter-concepto').value;
            const yearFilter = document.getElementById('filter-year').value;

            // Aplicar filtros
            filteredData = hospitalData.filter(item => {
                let matchesConcepto = true;
                if (conceptoFilter !== 'all') {
                    matchesConcepto = item.concepto.includes(
                        conceptoFilter === 'EGRESOS' ? 'EGRESOS HOSPITALARIOS' :
                            conceptoFilter === 'URGENCIAS' ? 'URGENCIAS' :
                                conceptoFilter === 'AFECCIONES' ? 'AFECCIONES EN LESIONES' :
                                    'EXTERNAS EN LESIONES'
                    );
                }

                const matchesYear = yearFilter === 'all' || item.a침o.toString() === yearFilter;
                return matchesConcepto && matchesYear;
            });

            updateMetrics();
            renderCharts();
            populateTable();
        }
    </script>
</body>

</html>