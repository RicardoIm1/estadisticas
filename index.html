<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estadísticas y Archivo Clínico</title>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="main_css/estilos.css" rel="stylesheet">
</head>
<body> 
  <div class="glass" id="dashboard">
    <h5>Inicio</h5>
      <div class="header">
        <div class="logo">
          <a href="/estadisticas" > <img src="./img/logo-hrpv.png" alt="Logo" width="120"></a>
        </div>
        <div>
          <div class="usuario">
          <i class="fas fa-user-circle"></i>
              <span id="user-info"></span>
            <!-- Botón de cerrar sesión -->
            <button onclick="cerrarSesion()" class="btn-salir-ultra">
              Salir
            </button>
          </div>
        </div>
      </div>

      <div class="grid">
        
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-cog"></i> Configuración</h3>
            <p>Ajustes y personalización</p>
          </div>
        </a>  
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-user"></i> Perfil</h3>
            <p>Información de usuario y preferencias</p>
          </div>
        </a>  
        
        <a href="capacitacion/" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Capacitación</h3>
            <p>Datos en tiempo real y análisis</p>
          </div>
        </a>
        
        <a href="https://docs.google.com/spreadsheets/d/1RpVZvHYxz76ofjT6OttXRjNRZx75lONPJfG2g9r6tCo/edit?gid=277125592#gid=277125592" style="text-decoration: none; color: inherit;" target="_blank">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Censo</h3>
            <p>Ocupación por servicio</p>
          </div>
        </a>
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Consulta Externa</h3>
            <p>BD de consulta externa</p>
          </div>
        </a>

        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Correcciones</h3>
            <p>BD Corregir</p>
          </div>
        </a>

        <a href="./defunciones" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Defunciones</h3>
            <p>Defunciones Generales</p>
          </div>  
        </a>  
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Egresos</h3>
            <p>BD Egresos</p>
          </div>  
        </a>  
        
        <a href="https://docs.google.com/spreadsheets/d/1FFI9Xcr9b6nqJdRqY7INXJT7MmzwXK0aHFY2xdqEfJE/edit?usp=sharing" target="_blank" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Hojas Faltantes</h3>
            <p>Hojas de Egresos incompletas o mal llenadas</p>
          </div>
        </a>
        
        <a href="indicadores.html" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Indicadores</h3>
            <p>Resumen del sistema y métricas</p>
          </div>
        </a>
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Nacimientos</h3>
            <p>BD Nacimientos</p>
          </div>
        </a>

        <a href="./caja/" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Pacientes Registrados</h3>
            <p>Acceso por Urgencias</p>
          </div>
        </a>
  
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Recetas</h3>
            <p>BD Recetas</p>
          </div>
        </a>
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Urgencias</h3>
            <p>BD Urgencias</p>
          </div>
        </a>
  
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Violencia y Lesiones</h3>
            <p>Registro de violencia y/o lesiones</p>
          </div>
        </a>
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>Traslados</h3>
            <p>BD Ambulancias</p>
          </div>
        </a>
        
        <a href="" style="text-decoration: none; color: inherit;">
          <div class="celda">
            <h3><i class="fas fa-files"></i>A ver qué mas se me ocurre</h3>
            <p>Registro de alguna otra chingadera</p>
          </div>
        </a>
      </div>
        
      <footer>
        <p id="footerText">Hecho con ❤️ por Ricardo · 2023</p>
      </footer>
    </div>
  </div>

    <script>
      function setEstado(estado) {
        const dashboard = document.getElementById('dashboard');
        const estadoTexto = document.getElementById('estadoTexto');
        dashboard.classList.remove('loading', 'success', 'error');
        dashboard.classList.add(estado);

        switch (estado) {
          case 'loading':
            estadoTexto.innerHTML = '<i class="fas fa-sync fa-spin"></i> Cargando sistema...';
            break;
          case 'success':
            estadoTexto.innerHTML = '<i class="fas fa-check-circle"></i> Sistema operativo con éxito ✅';
            break;
          case 'error':
            estadoTexto.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error detectado ❌';
            break;
        }
      }

      // Footer dinámico
      document.getElementById('footerText').innerHTML =
        `Hecho con ❤️ por Ricardo · ${new Date().getFullYear()}`;
  </script>

  <script>
    // ========== VERIFICACIÓN DE SESIÓN MEJORADA ==========
    function verificarAutenticacion() {
        const usuario = localStorage.getItem('usuario');
        const rol = localStorage.getItem('rol');
        const loginTime = localStorage.getItem('loginTime');
        
        if (!usuario || !rol || !loginTime) {
            console.log('❌ No hay sesión activa');
            window.location.href = 'index.html';
            return;
        }
        
        // Verificar expiración (24 horas)
        const ahora = new Date().getTime();
        const horasTranscurridas = (ahora - parseInt(loginTime)) / (1000 * 60 * 60);
        
        if (horasTranscurridas > 24) {
            console.log('⏰ Sesión expirada');
            localStorage.clear();
            window.location.href = 'index.html';
            return;
        }
        
        console.log('✅ Sesión activa:', usuario, 'Rol:', rol);
        
        // Mostrar en el header
        const userElement = document.getElementById('user-info');
        if (userElement) {
            userElement.innerHTML = `${usuario} (${rol})`;
        }
    }

        // Cerrar sesión
        function cerrarSesion() {
          if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
            localStorage.clear();

            // ✅ Ajusta la ruta de redirección al LOGIN REAL
            // Si el login está en la raíz del proyecto:
            window.location.href = '/estadisticas/login.html';
            // o, si estás dentro de una subcarpeta (por ejemplo, /panel/):
            // window.location.href = '../login.html';
          }
        }
       
        // Verificar al cargar la página
        window.addEventListener('load', verificarAutenticacion);
        
        // Hacer función global
        window.cerrarSesion = cerrarSesion;

        function verificarAutenticacion() {
          const usuario = localStorage.getItem('usuario');
          const rol = localStorage.getItem('rol');
          const loginTime = localStorage.getItem('loginTime');

          // ✅ Si no hay sesión activa, manda al login sin parpadeo
          if (!usuario || !rol || !loginTime) {
            console.warn('❌ No hay sesión activa');
            window.location.replace('/login.html');
            return;
          }

          // Verificar expiración (24 horas)
          const ahora = Date.now();
          const horasTranscurridas = (ahora - parseInt(loginTime)) / (1000 * 60 * 60);

          if (horasTranscurridas > 24) {
            console.warn('⏰ Sesión expirada');
            localStorage.clear();
            window.location.replace('estadisticas/login.html');
            return;
          }

          console.log('✅ Sesión activa:', usuario, 'Rol:', rol);

          const userElement = document.getElementById('user-info');
          if (userElement) {
            userElement.innerHTML = `${usuario} (${rol})`;
          }
        }

    </script>
  </body>
</html>
