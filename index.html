<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estad√≠sticas y Archivo Cl√≠nico</title>
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="./main_css/estilos.css" rel="stylesheet">
</head>

<body>
  <div class="glass" id="dashboard">
    <h5>Inicio</h5>
    <div class="header">
      <div class="logo">
        <a href="./estadisticas/"> <img src="./img/logo-hrpv.png" alt="Logo" width="120"></a>
      </div>
      <div>
        <div class="usuario">
          <i class="fa-solid fa-user-circle"></i>
          <span id="user-info"></span>
          <!-- Bot√≥n de cerrar sesi√≥n -->
          <button onclick="cerrarSesion()" class="btn-salir-ultra">
            Salir
          </button>
        </div>
      </div>
    </div>

    <div class="grid">

      <!--<a href="" style="text-decoration: none; color: inherit;" target="_blank">
        <div class="celda">
          <h3><i class="fa-solid fa-brain"></i> A ver qu√© m√°s se me ocurre</h3>
          <p>Registro de alguna otra chingadera</p>
        </div>
      </a>

       <a href="" style="text-decoration: none; color: inherit;" target="_blank">
        <div class="celda">
          <h3><i class="fa-solid fa-cog"></i> Configuraci√≥n</h3>
          <p>Ajustes y personalizaci√≥n</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_blank">
        <div class="celda">
          <h3><i class="fa-solid fa-user"></i> Perfil</h3>
          <p>Informaci√≥n de usuario y preferencias</p>
        </div>
      </a> -->

      <a href="./capacitacion/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-solid fa-graduation-cap"></i> Capacitaci√≥n</h3>
          <p>Formatos y Presentaciones</p>
        </div>
      </a>

      <a href="./censo/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-book-open"></i> Censo</h3>
          <p>Ocupaci√≥n por servicio</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;"target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-database"></i> Consulta Externa</h3>
          <p>BD de consulta externa</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-pen-to-square"></i> Correcciones</h3>
          <p>BD Corregir</p>
        </div>
      </a>

      <a href="./defunciones/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-cross"></i> Defunciones</h3>
          <p>Defunciones Generales</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-bed"></i> Egresos</h3>
          <p>BD Egresos</p>
        </div>
      </a>
      
      <a href="/estadisticas/gantt/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-chart-gantt"></i> Gantt</h3>
          <p>Diagrama de Avances</p>
        </div>
      </a>

      <a href="https://docs.google.com/spreadsheets/d/1FFI9Xcr9b6nqJdRqY7INXJT7MmzwXK0aHFY2xdqEfJE/edit?usp=sharing"
        target="_self" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-file-lines"></i> Hojas Faltantes</h3>
          <p>Hojas de Egresos incompletas o mal llenadas</p>
        </div>
      </a>

      <a href="/indicadores/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-clipboard-list"></i> Indicadores</h3>
          <p>Resumen del sistema y m√©tricas</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-baby"></i> Nacimientos</h3>
          <p>BD Nacimientos</p>
        </div>
      </a>

      <a href="/caja/" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-door-open"></i> Pacientes Registrados</h3>
          <p>Acceso por Urgencias</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-pills"></i> Recetas</h3>
          <p>BD Recetas</p>
        </div>
      </a>

      <a href="/estadisticas/control/reporte.html" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-gears"></i> Reporte de actividades</h3>
          <p>Informe de avances para Gantt</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-truck-medical"></i> Urgencias</h3>
          <p>BD Urgencias</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-heart-crack"></i> Violencia y Lesiones</h3>
          <p>Registro de violencia y/o lesiones</p>
        </div>
      </a>

      <a href="" style="text-decoration: none; color: inherit;" target="_self">
        <div class="celda">
          <h3><i class="fa-solid fa-car"></i> Traslados</h3>
          <p>BD Ambulancias</p>
        </div>
      </a>
    </div>

    <footer>
      <p id="footerText">Hecho con ‚ù§Ô∏è por Ricardo ¬∑ 2023</p>
    </footer>
  </div>
  </div>

  <script>
    function setEstado(estado) {
      const dashboard = document.getElementById('dashboard');
      const estadoTexto = document.getElementById('estadoTexto');
      dashboard.classList.remove('loading', 'success', 'error');
      dashboard.classList.add(estado);

      switch (estado) {
        case 'loading':
          estadoTexto.innerHTML = '<i class="fas fa-sync fa-spin"></i> Cargando sistema...';
          break;
        case 'success':
          estadoTexto.innerHTML = '<i class="fas fa-check-circle"></i> Sistema operativo con √©xito ‚úÖ';
          break;
        case 'error':
          estadoTexto.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error detectado ‚ùå';
          break;
      }
    }

    // Footer din√°mico
    document.getElementById('footerText').innerHTML =
      `Hecho con ‚ù§Ô∏è por Ricardo ¬∑ ${new Date().getFullYear()}`;
  </script>

  <script>
    // ========== VERIFICACI√ìN DE SESI√ìN CORREGIDA ==========
    function verificarAutenticacion() {
      const usuario = localStorage.getItem('usuario');
      const rol = localStorage.getItem('rol');
      const loginTime = localStorage.getItem('loginTime');

      console.log('üîç Verificando sesi√≥n:', { usuario, rol, loginTime });

      // ‚úÖ Si NO hay sesi√≥n activa, redirigir AL LOGIN CORRECTO
      if (!usuario || !rol || !loginTime) {
        console.warn('‚ùå No hay sesi√≥n activa - Redirigiendo a login');
        window.location.href = '/estadisticas/login.html';
        return false;
      }

      // Verificar expiraci√≥n (24 horas)
      const ahora = Date.now();
      const horasTranscurridas = (ahora - parseInt(loginTime)) / (1000 * 60 * 60);

      if (horasTranscurridas > 24) {
        console.warn('‚è∞ Sesi√≥n expirada - Redirigiendo a login');
        localStorage.clear();
        window.location.href = '/estadisticas/login.html';
        return false;
      }

      console.log('‚úÖ Sesi√≥n activa:', usuario, 'Rol:', rol);

      // Mostrar en el header
      const userElement = document.getElementById('user-info');
      if (userElement) {
        userElement.innerHTML = `${usuario} (${rol})`;
      }

      return true;
    }

    // Cerrar sesi√≥n
    function cerrarSesion() {
      if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
        localStorage.clear();
        // ‚úÖ Redirigir al login CORRECTO
        window.location.href = '/estadisticas/login.html';
      }
    }

    // Verificar al cargar la p√°gina - VERSI√ìN MEJORADA
    document.addEventListener('DOMContentLoaded', function () {
      console.log('üìç P√°gina cargada:', window.location.href);

      // Verificar sesi√≥n inmediatamente
      if (!verificarAutenticacion()) {
        console.log('üö® Redirecci√≥n en proceso...');
        // Detener cualquier ejecuci√≥n adicional
        return;
      }

      // Solo ejecutar esto si la sesi√≥n es v√°lida
      console.log('‚úÖ Sesi√≥n v√°lida, continuando...');

      // Hacer funci√≥n global
      window.cerrarSesion = cerrarSesion;
    });

    // Tambi√©n verificar en window.load por si acaso
    window.addEventListener('load', function () {
      console.log('üîÑ Window loaded - Verificando sesi√≥n nuevamente');
      verificarAutenticacion();
    });
  </script>
</body>

</html>