<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tablero Temporal — Informes</title>
  <style>
    :root {
      --accent: #2e86c1;
      --bg: #f5f7fa;
      --ok: #cff6d8;
      --warn: #ffe8c7;
    }
    body {
      font-family: Inter, Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 0;
    }
    .wrapper {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    /* Columna fija de informes */
    .col-fixed {
      width: 320px;
      background: white;
      border-right: 1px solid #e5e7eb;
      padding: 18px;
      overflow-y: auto;
    }
    .col-fixed h2 {
      margin-top: 0;
    }
    .informe-item {
      padding: 8px 6px;
      margin: 4px 0;
      font-size: 14px;
    }

    /* Carrusel temporal */
    .timeline {
      flex: 1;
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 18px;
      gap: 18px;
    }
    .mes-columna {
      min-width: 260px;
      background: white;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .mes-header {
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }
    .card-informe {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .card-informe.ok { background: var(--ok); }
    .card-informe.warn { background: var(--warn); }
    .card-informe input[type="text"] {
      width: 100%;
      margin-top: 4px;
      padding: 6px;
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
    }
    .nav-buttons {
      position: fixed;
      bottom: 14px;
      right: 14px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: var(--accent);
      color: white;
    }
  </style>
</head>
<body>
<div class="wrapper">

  <!-- Columna fija con todos los informes -->
  <div class="col-fixed">
    <h2>Informes</h2>
    <div id="listaInformesFija"></div>
  </div>

  <!-- Carrusel temporal -->
  <div id="timeline" class="timeline"></div>

</div>

<div class="nav-buttons">
  <button onclick="retroceder()">◀ Mes anterior</button>
  <button onclick="avanzar()">Mes siguiente ▶</button>
</div>

<script>
  const LLAVE = "tableroTemporalV1";

  const INFORMES = [
    "SINBA BD EGRESOS","SINBA BD URGENCIAS","SINBA BD LESIONES","SINBA BD NACIMIENTOS","SINBA BD DEFUNCIONES","SINBA GERENCIAL","RESUMEN DEFUNCIONES","CONCENTRADO GENERAL DEL CENSO","CORTA ESTANCIA","PRINCIPALES CAUSAS DE EGRESO","EXPEDIENTES CLINICOS NUEVOS","LABORATORIO","TAMIZ NEONATAL","CAPACITACIONES DE ENFERMERIA","VACUNAS","CARTILLAS DE SALUD","REHABILITACION","EPIDEMIOLOGIA","TRABAJO SOCIAL","SERVICIO DE AMBULANCIAS",
    "SUIVE SEMANAL 1","SUIVE SEMANAL 2","SUIVE SEMANAL 3","SUIVE SEMANAL 4","SUIVE SEMANAL 5"
  ];

  function obtener() {
    return JSON.parse(localStorage.getItem(LLAVE)) || {};
  }
  function guardar(x) { localStorage.setItem(LLAVE, JSON.stringify(x)); }

  function pintarInformesFijos() {
    const cont = document.getElementById("listaInformesFija");
    INFORMES.forEach(i => {
      const div = document.createElement("div");
      div.className = "informe-item";
      div.textContent = i;
      cont.appendChild(div);
    });
  }

  function generarMes(yyyy, mm) {
    const idMes = `${yyyy}-${String(mm).padStart(2,'0')}`;
    const datos = obtener();
    if (!datos[idMes]) datos[idMes] = {};

    const col = document.createElement("div");
    col.className = "mes-columna";

    col.innerHTML = `<div class='mes-header'>${idMes}</div>`;

    INFORMES.forEach(nombre => {
      const estado = datos[idMes][nombre] || { ruta:"", completo:false };

      const card = document.createElement("div");
      card.className = "card-informe";
      if (estado.ruta.trim() !== "") card.classList.add("ok");

      card.innerHTML = `
        <label style='font-size:13px;'>
          <input type='checkbox' ${estado.ruta?"checked":""} data-nombre='${nombre}' />
          ${nombre}
        </label>
        <input type='text' placeholder='Evidencia / URL' value='${estado.ruta}' data-ruta='${nombre}' />
      `;

      // eventos
      card.querySelector("input[type=checkbox]").addEventListener("change", e => {
        const d = obtener();
        if (!d[idMes]) d[idMes] = {};
        d[idMes][nombre] = d[idMes][nombre] || { ruta:"" };
        const tiene = d[idMes][nombre].ruta.trim() !== "";
        e.target.checked = tiene;
        guardar(d);
      });

      card.querySelector("input[type=text]").addEventListener("input", e => {
        const d = obtener();
        if (!d[idMes]) d[idMes] = {};
        d[idMes][nombre] = d[idMes][nombre] || {};
        d[idMes][nombre].ruta = e.target.value.trim();
        guardar(d);

        if (e.target.value.trim() !== "") card.classList.add("ok"); else card.classList.remove("ok");
        card.querySelector("input[type=checkbox]").checked = e.target.value.trim() !== "";
      });

      col.appendChild(card);
    });

    return col;
  }

  function cargarLineaTiempo() {
    const timeline = document.getElementById("timeline");
    timeline.innerHTML = "";

    const hoy = new Date();
    let yyyy = hoy.getFullYear();
    let mm = hoy.getMonth() + 1;

    for (let i = -2; i <= 2; i++) {
      let fecha = new Date(yyyy, mm - 1 + i);
      const c = generarMes(fecha.getFullYear(), fecha.getMonth() + 1);
      timeline.appendChild(c);
    }
  }

  function retroceder() {
    document.getElementById("timeline").scrollBy({ left: -300, behavior: 'smooth' });
  }
  function avanzar() {
    document.getElementById("timeline").scrollBy({ left: 300, behavior: 'smooth' });
  }

  pintarInformesFijos();
  cargarLineaTiempo();
</script>
</body>
</html>