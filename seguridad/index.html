<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Técnico Integral · Proyecto GAS</title>

<style>
:root{
  --primary:#2563eb;
  --bg:#f1f5f9;
  --card:#ffffff;
  --border:#e2e8f0;
  --text:#1e293b;
  --muted:#64748b;
  --success:#16a34a;
  --warning:#f59e0b;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;}

body{
  background:var(--bg);
  color:var(--text);
  padding:20px;
}

h1{font-size:1.5rem;margin-bottom:10px;}

header{
  margin-bottom:20px;
}

.progress-container{
  background:var(--border);
  border-radius:6px;
  height:10px;
  overflow:hidden;
  margin-top:8px;
}

.progress-bar{
  height:100%;
  width:0%;
  background:var(--success);
  transition:width .3s ease;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:10px;
  margin:20px 0;
}

.metric{
  background:var(--card);
  border:1px solid var(--border);
  padding:10px;
  border-radius:8px;
  font-size:.85rem;
}

.tabs{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:15px;
}

.tab-btn{
  padding:6px 12px;
  font-size:.85rem;
  border-radius:6px;
  border:1px solid var(--border);
  background:var(--card);
  cursor:pointer;
}

.tab-btn.active{
  background:var(--primary);
  color:white;
  border-color:var(--primary);
}

.tab-content{display:none;}
.tab-content.active{display:block;}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  padding:12px;
  margin-bottom:10px;
}

.accordion{
  cursor:pointer;
  font-weight:600;
  padding:8px;
  border-radius:6px;
  background:var(--bg);
  border:1px solid var(--border);
}

.panel{
  max-height:0;
  overflow:hidden;
  transition:max-height .3s ease;
  padding-left:10px;
}

.panel ul{list-style:none;padding:10px 0;}
.panel li{margin-bottom:5px;}

label{display:flex;gap:8px;font-size:.85rem;}

.audit-log{
  max-height:200px;
  overflow:auto;
  font-size:.75rem;
  background:#0f172a;
  color:#e2e8f0;
  padding:10px;
  border-radius:6px;
}

button.action{
  padding:6px 10px;
  font-size:.8rem;
  border-radius:6px;
  border:1px solid var(--border);
  background:white;
  cursor:pointer;
  margin-right:5px;
}

@media(min-width:900px){
  body{max-width:1100px;margin:auto;}
}
</style>
</head>

<body>

<header>
<h1>Panel Técnico Integral · Reestructura Proyecto GAS</h1>
<small>Seguimiento operativo detallado</small>
<div class="progress-container">
<div class="progress-bar" id="globalProgress"></div>
</div>
</header>

<section class="dashboard">
<div class="metric"><strong>Total tareas:</strong> <span id="totalTasks"></span></div>
<div class="metric"><strong>Completadas:</strong> <span id="completedTasks"></span></div>
<div class="metric"><strong>% Avance:</strong> <span id="percentComplete"></span></div>
<div class="metric"><strong>Último cambio:</strong> <span id="lastUpdate">—</span></div>
</section>

<section style="margin-bottom:15px;">
<button class="action" onclick="exportData()">Exportar JSON</button>
<button class="action" onclick="importData()">Importar JSON</button>
<button class="action" onclick="clearData()">Reset</button>
<input type="file" id="fileInput" style="display:none;">
</section>

<div class="tabs">
<button class="tab-btn active" data-tab="core">Core</button>
<button class="tab-btn" data-tab="sesiones">Sesiones</button>
<button class="tab-btn" data-tab="frontend">Frontend</button>
<button class="tab-btn" data-tab="seguridad">Seguridad</button>
<button class="tab-btn" data-tab="auditoria">Auditoría</button>
</div>

<div class="tab-content active" id="core">
<div class="card">
<div class="accordion">Arquitectura Modular</div>
<div class="panel">
<ul>
<li><label><input type="checkbox" data-section="core"> index.html como contenedor dinámico</label></li>
<li><label><input type="checkbox" data-section="core"> UUID como control de roles</label></li>
<li><label><input type="checkbox" data-section="core"> Backend separado (main.gs / auth.gs)</label></li>
<li><label><input type="checkbox" data-section="core"> Validación BigQuery optimizada</label></li>
</ul>
</div>
</div>
</div>

<div class="tab-content" id="sesiones">
<div class="card">
<div class="accordion">Sistema de Autenticación</div>
<div class="panel">
<ul>
<li><label><input type="checkbox" data-section="sesiones"> Login CURP + celular</label></li>
<li><label><input type="checkbox" data-section="sesiones"> Redirección estable</label></li>
<li><label><input type="checkbox" data-section="sesiones"> Persistencia obtenerSesionCompleta()</label></li>
<li><label><input type="checkbox" data-section="sesiones"> Logout seguro</label></li>
</ul>
</div>
</div>
</div>

<div class="tab-content" id="frontend">
<div class="card">
<div class="accordion">Compatibilidad</div>
<div class="panel">
<ul>
<li><label><input type="checkbox" data-section="frontend"> Eliminar backticks</label></li>
<li><label><input type="checkbox" data-section="frontend"> Safari iOS validado</label></li>
<li><label><input type="checkbox" data-section="frontend"> Responsive completo</label></li>
</ul>
</div>
</div>
</div>

<div class="tab-content" id="seguridad">
<div class="card">
<div class="accordion">Hardening</div>
<div class="panel">
<ul>
<li><label><input type="checkbox" data-section="seguridad"> Validación backend obligatoria</label></li>
<li><label><input type="checkbox" data-section="seguridad"> Sanitización inputs</label></li>
<li><label><input type="checkbox" data-section="seguridad"> Logs críticos activos</label></li>
</ul>
</div>
</div>
</div>

<div class="tab-content" id="auditoria">
<div class="card">
<strong>Registro de eventos</strong>
<div class="audit-log" id="auditLog"></div>
</div>
</div>

<script>
const checkboxes=document.querySelectorAll("input[type='checkbox']");
const progressBar=document.getElementById("globalProgress");
const totalTasksEl=document.getElementById("totalTasks");
const completedTasksEl=document.getElementById("completedTasks");
const percentEl=document.getElementById("percentComplete");
const lastUpdateEl=document.getElementById("lastUpdate");
const auditLog=document.getElementById("auditLog");

function updateMetrics(){
  const total=checkboxes.length;
  const completed=[...checkboxes].filter(cb=>cb.checked).length;
  const percent=Math.round((completed/total)*100);

  progressBar.style.width=percent+"%";
  totalTasksEl.textContent=total;
  completedTasksEl.textContent=completed;
  percentEl.textContent=percent+"%";
}

function logEvent(text){
  const time=new Date().toLocaleString();
  const entry=`[${time}] ${text}`;
  const logs=JSON.parse(localStorage.getItem("auditLog")||"[]");
  logs.push(entry);
  localStorage.setItem("auditLog",JSON.stringify(logs));
  renderLogs();
  lastUpdateEl.textContent=time;
}

function renderLogs(){
  const logs=JSON.parse(localStorage.getItem("auditLog")||"[]");
  auditLog.innerHTML=logs.slice(-50).reverse().join("<br>");
}

function saveState(){
  const state=[...checkboxes].map(cb=>cb.checked);
  localStorage.setItem("progressState",JSON.stringify(state));
  updateMetrics();
}

function loadState(){
  const state=JSON.parse(localStorage.getItem("progressState"));
  if(state){
    checkboxes.forEach((cb,i)=>cb.checked=state[i]);
  }
  updateMetrics();
  renderLogs();
}

checkboxes.forEach(cb=>{
  cb.addEventListener("change",()=>{
    logEvent((cb.checked?"✔ ":"✖ ")+cb.parentElement.textContent.trim());
    saveState();
  });
});

function exportData(){
  const data={
    state:JSON.parse(localStorage.getItem("progressState")),
    logs:JSON.parse(localStorage.getItem("auditLog"))
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="progreso_gas.json";
  a.click();
}

function importData(){
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change",function(){
  const file=this.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    const data=JSON.parse(e.target.result);
    localStorage.setItem("progressState",JSON.stringify(data.state));
    localStorage.setItem("auditLog",JSON.stringify(data.logs));
    loadState();
  };
  reader.readAsText(file);
});

function clearData(){
  localStorage.clear();
  location.reload();
}

document.querySelectorAll(".accordion").forEach(acc=>{
  acc.addEventListener("click",()=>{
    const panel=acc.nextElementSibling;
    panel.style.maxHeight?panel.style.maxHeight=null:panel.style.maxHeight=panel.scrollHeight+"px";
  });
});

document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

loadState();
</script>

</body>
</html>
